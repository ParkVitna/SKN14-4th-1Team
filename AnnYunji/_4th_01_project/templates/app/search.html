{% extends "layout/base.html" %}
{% load static %}

{% block title %}영양제 검색하기 · NutriWise{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/search.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
</style>
{% endblock %}

{% block content %}
<section class="container mt-5">
  <h2 class="text-center fw-bold mb-4">원하는 영양제를 검색해보세요</h2>

  <!-- 검색 폼 -->
  <form method="post" enctype="multipart/form-data" class="d-flex justify-content-center align-items-center gap-2 mb-4">
    {% csrf_token %}
    <input type="text" name="q" class="form-control w-50" placeholder="제품명 / 성분 / 브랜드로 검색" value="{{ request.POST.q }}">

    <!-- 카메라 버튼 -->
    <label class="camera-btn" title="이미지 업로드">
      <input type="file" name="image" id="image" class="d-none" accept="image/*" onchange="this.form.submit()">
      <i class="bi bi-camera"></i>
    </label>

    <button type="submit" class="btn btn-success">
      🔍 검색
    </button>
  </form>

  {% if response_list %}
  <h5 class="mb-3 text-success fw-bold">🧾 검색 결과</h5>

  <div class="row">
    <!-- 이미지가 있을 때만 좌측에 이미지 카드 -->
    {% if image_url %}
    <div class="col-md-4 image-container">
      <div class="card mb-4">
        <div class="card-header fw-bold">📸 업로드한 이미지</div>
        <img src="{{ image_url }}" class="uploaded-image" alt="Uploaded Image">
      </div>
    </div>
    {% endif %}

    <!-- 검색 결과 아코디언 -->
    <div class="{% if image_url %}col-md-8{% else %}col-md-12{% endif %}">
      <div class="accordion" id="productAccordion">
        {% for item in response_list %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
            <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse-{{ forloop.counter }}"
                    aria-expanded="false"
                    aria-controls="collapse-{{ forloop.counter }}">
              {{ item.name }}
            </button>
          </h2>
          <div id="collapse-{{ forloop.counter }}"
               class="accordion-collapse collapse"
               aria-labelledby="heading-{{ forloop.counter }}"
               data-bs-parent="#productAccordion">
            <div class="accordion-body">
              {% if item.brand %}<p><strong>브랜드:</strong> {{ item.brand }}</p>{% endif %}
              {% if item.benefits %}<p><strong>기대효과:</strong> {{ item.benefits }}</p>{% endif %}
              {% if item.how_to_take %}<p><strong>섭취 방법:</strong> {{ item.how_to_take }}</p>{% endif %}
              {% if item.ingredients %}<p><strong>성분:</strong> {{ item.ingredients }}</p>{% endif %}
              {% if item.cautions %}<p><strong>주의사항:</strong> {{ item.cautions }}</p>{% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
{% endblock %}
